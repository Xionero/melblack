<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meltopia Citizen</title>
  <style>
    body {
      font-family: 'Yu Gothic', 'Arial', sans-serif;
      background-color: transparent;
      color: #333;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
      @font-face {
  font-family: 'Pong-Game';
  src: url('assets/css/Pong-Game.ttf') format('truetype'); /* Update with the correct path to the font */
    }
    #leaderboard {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
    }
    .card {     
      background-size: cover; /* เพิ่มบรรทัดนี้เพื่อให้รูปภาพครอบคลุมพื้นที่ */
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      width: 300px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid #ccc;
      box-sizing: border-box;
      position: relative;
      cursor: pointer; /* เพิ่ม cursor pointer เพื่อให้รู้ว่าการ์ดสามารถคลิกได้ */
      transition: transform 0.2s;
}

    .card:hover {
      transform: scale(1.05); /* เพิ่มเอฟเฟ็กต์ขยายเมื่อวางเมาส์ */
    }
    .profile-pic {
      width: 75px;
      height: 100px;
      margin-right: 0px;
      border-radius: 5px;
      border: 2px solid #000;
      object-fit: cover;
      margin-left: -20px; /* Move details up closer to the header */
      margin-top: -25px
    }
    .card-content {
      display: flex;
      align-items: center;
      width: 100%;
      margin-left: 20px; /* Shift the card content slightly to the left */
      margin-top: 0px; /* Adjust margin as needed */
    }
    .card-header {
    font-family: 'Pong-Game', sans-serif;
    font-size: 20px; 
    margin-bottom: 30px; /* ลดลงจาก 35px */
    margin-top: -5px; /* ขยับส่วนหัวขึ้น */
    color: #353535;
    position: relative;
    text-align: center;
    width: 100%;
    border-bottom: 2px solid #353535; /* เพิ่มเส้นใต้ */
    padding-bottom: 5px; /* เพิ่มช่องว่างระหว่างเส้นใต้และข้อความ */
}
    .race-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #333;
      object-fit: cover;
      position: absolute;
      top: 1px;
      left: 1px;
    }
    .card-details {
      display: flex;
      flex-direction: column;
      flex: 1;
      padding: 5px;
      box-sizing: border-box;
      margin-top: -25px; /* Move details up closer to the header */ 
      line-height: 1.5; /* ปรับระยะห่างระหว่างบรรทัด */
      -webkit-text-stroke: 0.2px rgb(0, 0, 0); /* Add white outline */
    }
    .card p {
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: flex-start;
      width: 100%;
      font-size: 12px;
    }
    .card p span {
      font-weight: bold;
      text-align: left;
      margin-right: 10px;
    }
    .card p .value {
      text-align: left;
    }
.zeny-0 {
  background: #040404 url("assets/img/stone.jpg") top right no-repeat;
  background-color: #fcf2e6;
  border: 4px solid #aaaaaa; /* เพิ่มขนาดขอบ */
}

.zeny-1-99 {
  background: #040404 url("assets/img/tree.jpg") top right no-repeat;
  background-color: #72f5ce;
  border: 4px solid #6da87b; /* เพิ่มขนาดขอบ */
}

.zeny-100-499 {
  background: #040404 url("assets/img/sea.jpg") top right no-repeat;
  background-color: #a2bbff;
  border: 4px solid #8ca6df; /* เพิ่มขนาดขอบ */
}

.zeny-500-999 {
  background: #040404 url("assets/img/fire.jpg") top right no-repeat;
  background-color: #f55363;
  border: 4px solid #ff6070; /* เพิ่มขนาดขอบ */
}

.zeny-1000-plus {
  background: #040404 url("assets/img/gold.jpg") top right no-repeat;
  background-color: #ffab5d;
  border: 4px solid #ffb547; /* เพิ่มขนาดขอบ */
}

.zeny-infinity {
  background: #040404 url("assets/img/space.jpg") top right no-repeat !important;
  border: 4px solid #1f1f1f !important; /* เพิ่มขนาดขอบ */
}

.zeny-infinity .card-header, 
.zeny-infinity .card-details p {
  color: #eeeeee !important;
}

.zeny-infinity .card-header::after {
  background-color: #eeeeee !important;
}

.progress-bar-container {
  width: 100%;
  height: 8px;
  background-color: #eee;
  border-radius: 5px;
  margin-top: 10px;
  position: relative;
}

.progress-barx {
  height: 100%;
  border-radius: 5px;
  width: 0;
  transition: width 0.3s;
  background: linear-gradient(to right, #ffd06a, #ff6a6a);
}

.progress-bar-textx {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #333;
  font-size: 10px;
  white-space: nowrap;
}

    #fullSizeImageContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #fullSizeImage {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }
    button {
      position: fixed; /* Changed to fixed for better centering */
      right: 20px;
      top: 11%; /* Center vertically */
      transform: translateY(-50%); /* Adjust for exact vertical centering */
      background-color: #fff;
      border: none;
      padding: 10px;
      cursor: pointer;
      font-size: 16px;
    }
.coin-icon {
  width: 15px; /* Adjust the size as needed */
  height: 15px; /* Adjust the size as needed */
  vertical-align: middle; /* Align the icon vertically with the text */
}

.name {
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  position: relative;
  -webkit-text-stroke: 0.3px rgb(0, 0, 0); /* Add white outline */
}

.name-long {
  font-size: 10px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  position: relative;
  top: 1.5px;
  -webkit-text-stroke: 0.2px rgb(0, 0, 0); /* Add white outline */
}

.name-longest {
  font-size: 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  position: relative;
  top: 1.5px;
  -webkit-text-stroke: 0.2px rgb(0, 0, 0); /* Add white outline */
}

.name-longestfar {
  font-size: 6px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  position: relative;
  top: 7px;
  -webkit-text-stroke: 0.2px rgb(0, 0, 0); /* Add white outline */
}
.mod-color {
  color: #f73d65; /* สีพื้นฐานของข้อความ */
  -webkit-text-stroke: 0.2px rgb(236, 56, 56); /* Add white outline */
}
.job-value {
  white-space: nowrap;
}
  </style>
</head>
<body>
  <div id="leaderboard">
    <!-- ข้อมูลนักผจญภัยจะถูกแสดงที่นี่ -->
  </div>

  <div id="fullSizeImageContainer" style="display: none;">
    <img id="fullSizeImage" src="" alt="Full Size Image">
    <button onclick="closeImage()">Close</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', fetchLeaderboard);
    setInterval(fetchLeaderboard, 3000);

    function fetchLeaderboard() {
  fetch('https://script.google.com/macros/s/AKfycbx67k-Ev63AZys0sKJgiqWVacanih7jSod_BVfVAQ4OcWZNHnB_DslQBLepEF8rbrbulw/exec')
    .then(response => response.json())
    .then(data => {
      const leaderboard = document.getElementById('leaderboard');
      leaderboard.innerHTML = ""; 
      data.slice(0, 100).forEach((row) => {
        const card = document.createElement('div');
        card.className = 'card';
        
        if (row.zeny === '∞') {
          card.classList.add('zeny-infinity');
        } else if (row.zeny >= 1000) {
          card.classList.add('zeny-1000-plus');
        } else if (row.zeny >= 500) {
          card.classList.add('zeny-500-999');
        } else if (row.zeny >= 100) {
          card.classList.add('zeny-100-499');
        } else if (row.zeny >= 1) {
          card.classList.add('zeny-1-99');
        } else {
          card.classList.add('zeny-0');
        }

        let nameClass = 'name';
        if (row.name.length > 40) {
          nameClass = 'name-longestfar';
        } else if (row.name.length > 30) {
          nameClass = 'name-longest';
        } else if (row.name.length > 20) {
          nameClass = 'name-long';
        }

        const { level, remainingEXP } = calculateLevel(row.exp);
        const expTable = [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60];
        const nextLevelExp = level < 20 ? expTable[level] : expTable.slice(1, 21).reduce((acc, val) => acc + val, 0);
        const progressPercentage = level < 20 ? (remainingEXP / nextLevelExp) * 100 : 100;

        const levelText = level < 20 ? `${level}` : '20 Max';
        const rank = calculateRank(row.rankexp); // Determine rank

        const raceStyle = level >= 10 ? '-webkit-text-stroke: 0.5px rgb(255, 13, 13);' : '';
        const lvStyle = level >= 10 ? '-webkit-text-stroke: 0.5px rgb(255, 13, 13);' : '';

        let raceIcon = '';
        const validRaces = ['Human', 'Elf', 'Dwarf', 'Angel', 'Demon','Goblin', 'Fairy', 'Dryad', 'Dragon', 'Vampire', 'Werebeast', 'Mermaid', 'Orc', 'Slime', 'Undead', 'Unknown'];

        let raceName = row.race;

        if (level >= 10) {
          switch (raceName) {
            case 'Human':
              raceName = 'Hero';
              break;
            case 'Elf':
              raceName = 'High Elf';
              break;
            case 'Dwarf':
              raceName = 'Dwarf King';
              break;
            case 'Angel':
              raceName = 'Arc Angel';
              break;
            case 'Goblin':
              raceName = 'Hobgoblin';
              break;
            case 'Fairy':
              raceName = 'Fairy Queen';
              break;
            case 'Dryad':
              raceName = 'Elder Dryad';
              break;
            case 'Dragon':
              raceName = 'Elder Dragon';
              break;
            case 'Vampire':
              raceName = 'Vampire Lord';
              break;
            case 'Werebeast':
              raceName = 'Warlord Beast';
              break;
            case 'Mermaid':
              raceName = 'Mermaid Queen';
              break;
            case 'Demon':
              raceName = 'Demon Lord';
              break;
            case 'Slime':
              raceName = 'Demon Slime';
              break;
            case 'Undead':
              raceName = 'Lich';
              break;
            default:
              raceName = row.race;
              break;
          }
        }

        if (validRaces.includes(row.race)) {
          let raceFileName = raceName.toLowerCase().replace(/ /g, '_');
          raceIcon = `<img src="race/${raceFileName}.png" alt="${raceName} icon" class="race-icon">`;
        } else {
          console.error(`Race ${row.race} is not valid.`);
        }

        card.innerHTML = `
          <div class="card-header">Meltopia Adventure Card</div>
          <div class="card-content">
            <img src="${row.image}" alt="Profile Picture" class="profile-pic">
            <div class="card-details">
              <p><span>Name&nbsp;:</span> <span class="${nameClass}">${row.name}&nbsp;<span class="mod-color">${row.mod}</span></p>
              <p><span>Lv&nbsp:</span> <span class="value" style="${lvStyle}">&nbsp;${levelText}</span></p>
              <p><span>Rank&nbsp;:</span> <span class="value">${rank}</span></p>
              <p><span>Race&nbsp;:</span> <span class="value" style="${raceStyle}">${raceName}</span></p>
              <p><span>Class&nbsp;:</span> <span class="job-value">${row.class}&nbsp;I&nbsp;${row.job}</span></p>
              <p><span>Gold&nbsp;:</span> <span class="value">${row.zeny}</span><img src="race/coin.png" alt="coin" class="coin-icon"></p>
            </div>
          </div>
          <div class="progress-bar-container">
            <div class="progress-barx" style="width: ${progressPercentage}%"></div>
            <div class="progress-bar-textx">${Math.round(progressPercentage)}%</div>
          </div>             
          ${raceIcon}
        `;

        card.addEventListener('click', () => {
    const imageSrc = `${row.image}`;

    // Create a new image element
    const img = document.createElement('img');
    img.src = imageSrc;
    img.style.width = '525px'; // 750px * 0.7 = 525px
    img.style.height = '700px'; // 1000px * 0.7 = 700px
    img.style.border = '8px solid #888'; // Gray border
    img.style.borderRadius = '10px'; // Rounded corners
    img.style.objectFit = 'cover'; // Maintain aspect ratio and cover dimensions

    // Create a container for the image
    const container = document.createElement('div');
    container.style.position = 'fixed';
    container.style.top = '0';
    container.style.left = '0';
    container.style.width = '100%';
    container.style.height = '100%';
    container.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
    container.style.display = 'flex';
    container.style.justifyContent = 'center';
    container.style.alignItems = 'center';
    container.style.zIndex = '1000';
    container.style.overflow = 'hidden'; // Hide overflow to ensure no scrollbars

    // Append the image to the container
    container.appendChild(img);

    // Append the container to the body
    document.body.appendChild(container);

    // Add an event listener to close the image when clicking outside of it
    container.addEventListener('click', () => {
        document.body.removeChild(container);
    });
});



        leaderboard.appendChild(card);
      });
    })
    .catch(error => console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error));
}

    function showImage(imageSrc) {
      const fullSizeImage = document.getElementById('fullSizeImage');
      const fullSizeImageContainer = document.getElementById('fullSizeImageContainer');
      fullSizeImage.src = imageSrc;
      fullSizeImageContainer.style.display = 'flex'; // แสดงภาพเต็มขนาด
    }

    function closeImage() {
      document.getElementById('fullSizeImageContainer').style.display = 'none';
    }

    function calculateLevel(exp) {
      const expTable = [0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60];
      let level = 1;
      let accumulatedEXP = 0;

      while (level < expTable.length && exp >= accumulatedEXP + expTable[level]) {
        accumulatedEXP += expTable[level];
        level++;
      }

      // Cap the level at 20
      if (level > 20) {
        level = 20;
        accumulatedEXP = expTable.slice(1, 21).reduce((acc, val) => acc + val, 0);
      }

      const remainingEXP = exp - accumulatedEXP;

      return { level, remainingEXP };
    }
    function calculateRank(rankexp) {
    if (rankexp >= 500) return '<span style="color: gold; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">S</span>';     // Gold for S rank
    if (rankexp >= 350) return '<span style="color: silver; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">A</span>';   // Silver for A rank
    if (rankexp >= 250) return '<span style="color: bronze; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">B</span>';   // Bronze for B rank
    if (rankexp >= 150) return '<span style="color: green; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">C</span>';    // Green for C rank
    if (rankexp >= 100) return '<span style="color: blue; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">D</span>';     // Blue for D rank
    if (rankexp >= 50) return '<span style="color: purple; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">E</span>';    // Purple for E rank
    if (rankexp >= 25) return '<span style="color: brown; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">F</span>';     // Brown for F rank
    return '<span style="color: gray; -webkit-text-stroke: 0.3px rgb(0, 0, 0);">G</span>';                         // Gray for G rank
}
  </script>

</body>
</html>
